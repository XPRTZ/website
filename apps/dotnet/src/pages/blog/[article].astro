---
import Layout from "../../layouts/layout.astro";
import { fetchData, type Article } from "@xprtz/cms";
import { ContentAstro as Content } from "@xprtz/ui";

export async function getStaticPaths() {
  ///api/articles?
  // sort[0]=date:desc&
  // filters[site][$eq]=dotnet&
  // populate[authors][fields]=*&
  // populate[authors][populate][avatar][fields][0]=url&
  // populate[image][fields][0]=url&
  // status=published

  const pageData = await fetchData<Array<Article>>({
    endpoint: "articles",
    wrappedByKey: "data",
    query: {
      "sort[0]": "date:desc",
      "filters[site][$eq]": "dotnet",
      "populate[authors][fields]": "*",
      "populate[authors][populate][avatar][fields][0]=url": "url",
      "populate[image][fields][0]": "url",
      status: "published",
    },
  });

  return pageData.map((data: Article) => ({
    params: { article: data.slug },
    props: data,
  }));
}

const article: Article = Astro.props;
const formattedDate = new Date(article.date).toLocaleDateString("nl-NL", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout title={article.title} description={article.title}>
  <Content
    title_website={article.title}
    description={article.title}
    content={article.content}
    firstname={article.authors[0].firstname}
    lastname={article.authors[0].lastname}
    date={formattedDate}
  />
</Layout>
