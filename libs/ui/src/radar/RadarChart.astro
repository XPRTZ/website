---
import RadarQuadrant from "./RadarQuadrant.astro";
import RadarQuadrantItemList from "./RadarQuadrantItemList.astro";
import type { RadarItem, RadarItemWithNumber } from "@xprtz/cms";
import { RINGS, QUADRANTS, type QuadrantName } from "./radarUtils";

interface Props {
  /**
   * Array of radar items to display on the chart
   */
  items?: RadarItem[];

  /**
   * Size of each quadrant in pixels
   */
  quadrantSize?: number;

  /**
   * Slug of the parent page (for back links from radar items)
   */
  parentPageSlug?: string;
}

const { items = [], quadrantSize = 400, parentPageSlug } = Astro.props;

// Margin between quadrants
const margin = 20;

// Add numbers to items and group by quadrant
const itemsWithNumbers: RadarItemWithNumber[] = items.map((item, index) => ({
  ...item,
  number: index + 1,
}));

const itemsByQuadrant = Object.fromEntries(
  Object.keys(QUADRANTS).map((quadrantName) => [
    quadrantName,
    itemsWithNumbers.filter((item) => item.quadrant === quadrantName),
  ])
) as Record<QuadrantName, RadarItemWithNumber[]>;

// Helper maps for positioning
const flexClassMap: Record<string, string> = {
  "top-left": "flex justify-end items-end",
  "top-right": "flex justify-start items-end",
  "bottom-left": "flex justify-end items-start",
  "bottom-right": "flex justify-start items-start",
};

const labelPositionMap: Record<string, { style: string; align: string }> = {
  "top-left": { style: "top: 0; left: 0;", align: "text-left" },
  "top-right": { style: "top: 0; right: 0;", align: "text-right" },
  "bottom-left": { style: "bottom: 0; left: 0;", align: "text-left" },
  "bottom-right": { style: "bottom: 0; right: 0;", align: "text-right" },
};

// Pre-calculate ring label positions and styles
const ringLabelData = RINGS.map((ring, index) => {
  const radius = quadrantSize * (ring.radiusPosition / 100);
  const prevRadius =
    index > 0 ? quadrantSize * (RINGS[index - 1].radiusPosition / 100) : 0;
  const ringCenter = prevRadius + (radius - prevRadius) / 2;
  // Calculate opacity: inner rings (Adopt) darker, outer rings (Hold) lighter
  const opacity = 1 - index * 0.1;

  return {
    label: ring.label,
    ringCenter,
    opacity,
  };
});
---

<div class="radar-chart-wrapper">
  <div class="radar-chart-container">
    <div class="relative radar-chart">
      <!-- Quadrants Grid -->
      <div class="grid grid-cols-2 grid-rows-2" style={`gap: ${margin}px;`}>
        {
          Object.entries(QUADRANTS).map(([name, config]) => {
            const flexClasses = flexClassMap[config.gridPosition];
            return (
              <div
                class={`${flexClasses} quadrant-wrapper transition-opacity duration-300`}
                data-quadrant={config.key}
              >
                <RadarQuadrant
                  quadrantName={name as QuadrantName}
                  size={quadrantSize}
                  items={itemsByQuadrant[name as QuadrantName]}
                  parentPageSlug={parentPageSlug}
                />
              </div>
            );
          })
        }
      </div>

      <!-- Ring Labels - Horizontal (between Tools and Platforms - left side) -->
      <div
        class="absolute left-0 flex justify-center items-center ring-labels transition-opacity duration-300"
        data-ring-labels="left"
        style={`top: ${quadrantSize}px; height: ${margin}px; width: ${quadrantSize}px;`}
      >
        {
          ringLabelData.map((data) => {
            const leftPosition = quadrantSize - data.ringCenter;
            const labelStyle = `left: ${leftPosition}px; height: ${margin}px; opacity: ${data.opacity};`;

            return (
              <div
                class="absolute text-xs font-bold text-gray-600 flex items-center -translate-x-1/2"
                style={labelStyle}
              >
                {data.label}
              </div>
            );
          })
        }
      </div>

      <!-- Ring Labels - Horizontal (between Techniques and Languages & Frameworks - right side) -->
      <div
        class="absolute right-0 flex justify-center items-center ring-labels transition-opacity duration-300"
        data-ring-labels="right"
        style={`top: ${quadrantSize}px; height: ${margin}px; width: ${quadrantSize}px;`}
      >
        {
          ringLabelData.map((data) => {
            const labelStyle = `left: ${data.ringCenter}px; height: ${margin}px; opacity: ${data.opacity};`;

            return (
              <div
                class="absolute text-xs font-bold text-gray-600 flex items-center -translate-x-1/2"
                style={labelStyle}
              >
                {data.label}
              </div>
            );
          })
        }
      </div>

      <!-- Quadrant Labels in Corners -->
      {
        Object.entries(QUADRANTS).map(([name, config]) => {
          const position = labelPositionMap[config.gridPosition];
          const labelStyle = `${position.style} padding: 8px; color: ${config.color};`;

          return (
            <div
              class={`absolute text-lg font-bold ${position.align} quadrant-label transition-opacity duration-300`}
              data-label-quadrant={config.key}
              style={labelStyle}
            >
              {name}
            </div>
          );
        })
      }
    </div>
  </div>

  <!-- Quadrant Tiles for mobile (hidden by default, shown below 870px) -->
  <div class="quadrant-tiles" style="display: none;">
    {
      Object.entries(QUADRANTS).map(([name, config]) => (
        <div
          class="quadrant-tile"
          data-quadrant-tile={config.key}
          style={`background-color: ${config.color};`}
        >
          {name}
        </div>
      ))
    }
  </div>

  <!-- Quadrant Item Lists (hidden by default) -->
  {
    Object.entries(QUADRANTS).map(([name, config]) => (
      <RadarQuadrantItemList
        items={itemsByQuadrant[name as QuadrantName]}
        quadrantName={name}
        color={config.color}
        parentPageSlug={parentPageSlug}
      />
    ))
  }
</div>

<style>
  .radar-chart-wrapper {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    position: relative;
    width: 100%;
    max-width: 100%;
    /* Animation timing variables */
    --fade-out-duration: 300ms;
    --fade-out-delay: 100ms;
    --fade-in-duration: 400ms;
    --zoom-duration: 500ms;
    --slide-duration: 400ms;
    /* Reusable style values */
    --transition-easing: cubic-bezier(0.4, 0, 0.2, 1);
    --zoom-scale: 1.75;
    --hover-dim-opacity: 0.5;
    transform-origin: center top;
  }

  .radar-chart-container {
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: transform var(--slide-duration) var(--transition-easing);
  }

  .radar-chart-wrapper.list-visible .radar-chart-container {
    transform: translateX(-200px);
  }

  /* Position item lists absolutely to prevent layout jump */
  .radar-chart-wrapper :global(.quadrant-item-list) {
    position: absolute;
    left: calc(50% + 220px);
    top: 0;
    z-index: 20;
  }

  @media (max-width: 1280px) and (min-width: 1001px) {
    .radar-chart-wrapper {
      transform: scale(calc(100vw / 1350px));
      /* Dynamically adjust height to match the scaled visual height */
      height: calc(820px * (100vw / 1350px));
    }
  }

  @media (max-width: 1000px) {
    .radar-chart-container {
      display: none;
    }

    /* Override list positioning for mobile - ensure it ends up centered */
    .radar-chart-wrapper :global(.quadrant-item-list) {
      left: 50%;
      margin-left: -192px; /* Half of list width (384px / 2) */
    }

    .quadrant-tiles {
      display: grid !important;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 0 auto;
      transition:
        transform var(--slide-duration) var(--transition-easing),
        opacity var(--slide-duration) var(--transition-easing);
    }

    .quadrant-tiles.sliding-out {
      transform: translateX(-100%);
      opacity: 0;
    }

    .quadrant-tiles.sliding-in {
      transform: translateX(-100%);
      opacity: 0;
    }

    .radar-chart-wrapper.list-animation-complete .quadrant-tiles {
      display: none !important;
    }

    /* Keep list centered even after animation completes */
    .radar-chart-wrapper.list-animation-complete :global(.quadrant-item-list) {
      position: static;
      transform: none;
      left: auto;
      margin-left: 0;
    }

    .quadrant-tile {
      aspect-ratio: 1;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.125rem;
      font-weight: bold;
      color: white;
      position: relative;
      z-index: 1;
      /* Use transition only for hover effects, not zoom */
      transition: box-shadow 0.3s ease;
    }

    .quadrant-tile:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Hover dim effect for tiles */
    .quadrant-tiles.hovering .quadrant-tile {
      opacity: var(--hover-dim-opacity);
    }

    .quadrant-tiles.hovering .quadrant-tile.active {
      opacity: 1;
    }

    /* Zoom effect for tiles */
    .quadrant-tiles.zoomed .quadrant-tile {
      opacity: 0;
      pointer-events: none;
    }

    .quadrant-tiles.zoomed .quadrant-tile.zoomed-in {
      opacity: 1;
      pointer-events: auto;
      z-index: 10;
    }

    /* Transform origins for each corner */
    .quadrant-tile[data-quadrant-tile="tools"] {
      transform-origin: top left;
    }

    .quadrant-tile[data-quadrant-tile="techniques"] {
      transform-origin: top right;
    }

    .quadrant-tile[data-quadrant-tile="platforms"] {
      transform-origin: bottom left;
    }

    .quadrant-tile[data-quadrant-tile="frameworks"] {
      transform-origin: bottom right;
    }

    /* Zoom in animation - applied when zooming in */
    .quadrant-tile.zooming-in {
      animation: tileZoomIn var(--zoom-duration) var(--transition-easing)
        forwards;
      z-index: 10;
    }

    /* Zoom out animation - applied when zooming out */
    .quadrant-tile.zooming-out {
      animation: tileZoomOut var(--zoom-duration) var(--transition-easing)
        forwards;
      z-index: 10;
    }

    /* Keep zoomed state after animation completes */
    .quadrant-tiles.zoomed .quadrant-tile.zoomed-in {
      transform: scale(2.05);
    }

    @keyframes tileZoomIn {
      from {
        transform: scale(1);
        opacity: 1;
      }
      to {
        transform: scale(2.05);
        opacity: 1;
      }
    }

    @keyframes tileZoomOut {
      from {
        transform: scale(2.05);
        opacity: 1;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
  }

  @media (max-width: 360px) {
    .quadrant-tiles {
      grid-template-columns: 1fr;
    }

    /* Disable hover effects in single column */
    .quadrant-tiles.hovering .quadrant-tile {
      opacity: 1 !important;
    }

    /*
     * Single column layout: replace zoom animation with subtle pulse effect.
     * - Dims non-selected tiles instead of hiding them
     * - Selected tile gets a pulse animation instead of scaling
     */
    .quadrant-tile.zooming-in {
      animation: pulse-subtle 0.5s ease-in-out !important;
      transform: none !important;
    }

    .quadrant-tile.zooming-out {
      animation: none !important;
      transform: none !important;
    }

    .quadrant-tiles.zoomed .quadrant-tile {
      opacity: 0.3 !important;
      pointer-events: auto !important;
      transition: opacity 0.3s ease-in-out;
    }

    .quadrant-tiles.zoomed .quadrant-tile.zoomed-in,
    .quadrant-tiles.zoomed .quadrant-tile.zoomed-in[data-quadrant-tile="tools"],
    .quadrant-tiles.zoomed
      .quadrant-tile.zoomed-in[data-quadrant-tile="techniques"],
    .quadrant-tiles.zoomed
      .quadrant-tile.zoomed-in[data-quadrant-tile="platforms"],
    .quadrant-tiles.zoomed
      .quadrant-tile.zoomed-in[data-quadrant-tile="frameworks"] {
      transform: none !important;
      opacity: 1 !important;
      box-shadow:
        0 0 0 3px rgba(255, 255, 255, 0.5),
        0 0 20px rgba(0, 0, 0, 0.3);
    }

    @keyframes pulse-subtle {
      0% {
        box-shadow:
          0 0 8px 0 rgba(0, 0, 0, 0.4),
          0 0 20px rgba(0, 0, 0, 0.3);
      }
      50% {
        box-shadow:
          0 0 12px 6px rgba(0, 0, 0, 0.3),
          0 0 25px rgba(0, 0, 0, 0.5);
      }
      100% {
        box-shadow:
          0 0 10px 3px rgba(0, 0, 0, 0.35),
          0 0 20px rgba(0, 0, 0, 0.3);
      }
    }
  }

  .radar-chart.hovering .quadrant-wrapper {
    opacity: var(--hover-dim-opacity);
  }

  .radar-chart.hovering .quadrant-wrapper.active {
    opacity: 1;
  }

  .radar-chart.hovering .quadrant-label {
    opacity: var(--hover-dim-opacity);
  }

  .radar-chart.hovering .quadrant-label.active {
    opacity: 1;
  }

  /* Zoom functionality */
  .quadrant-wrapper {
    cursor: pointer;
    transition: all var(--zoom-duration) var(--transition-easing);
    transform-origin: center;
    position: relative;
  }

  .radar-chart.zoomed .quadrant-wrapper {
    opacity: 0;
    pointer-events: none;
  }

  .radar-chart.zoomed .quadrant-wrapper.zoomed-in {
    opacity: 1;
    pointer-events: auto;
    transform: scale(var(--zoom-scale)) translate(0, 0);
  }

  /* Position adjustments for each quadrant when zoomed */
  .radar-chart.zoomed .quadrant-wrapper.zoomed-in[data-quadrant="tools"] {
    transform: scale(var(--zoom-scale)) translate(25%, 25%);
  }

  .radar-chart.zoomed .quadrant-wrapper.zoomed-in[data-quadrant="techniques"] {
    transform: scale(var(--zoom-scale)) translate(-25%, 25%);
  }

  .radar-chart.zoomed .quadrant-wrapper.zoomed-in[data-quadrant="platforms"] {
    transform: scale(var(--zoom-scale)) translate(25%, calc(-25% - 15px));
  }

  .radar-chart.zoomed .quadrant-wrapper.zoomed-in[data-quadrant="frameworks"] {
    transform: scale(var(--zoom-scale)) translate(-25%, calc(-25% - 15px));
  }

  .radar-chart.zoomed .quadrant-label {
    display: none;
  }

  /* Ring labels positioning and transitions */
  .ring-labels {
    transition: all var(--zoom-duration) var(--transition-easing);
    transform-origin: center;
  }

  /* Hide ring labels by default when zoomed */
  .radar-chart.zoomed .ring-labels {
    opacity: 0;
    pointer-events: none;
  }

  /* Show and transform ring labels for Tools quadrant (top-left) */
  .radar-chart.zoomed.zoom-tools .ring-labels[data-ring-labels="left"] {
    opacity: 1;
    transform: scale(var(--zoom-scale)) translate(25%, 190px);
  }

  /* Show and transform ring labels for Platforms quadrant (bottom-left) */
  .radar-chart.zoomed.zoom-platforms .ring-labels[data-ring-labels="left"] {
    opacity: 1;
    transform: scale(var(--zoom-scale)) translate(25%, -205px);
  }

  /* Show and transform ring labels for Techniques quadrant (top-right) */
  .radar-chart.zoomed.zoom-techniques .ring-labels[data-ring-labels="right"] {
    opacity: 1;
    transform: scale(var(--zoom-scale)) translate(-25%, 190px);
  }

  /* Show and transform ring labels for Frameworks quadrant (bottom-right) */
  .radar-chart.zoomed.zoom-frameworks .ring-labels[data-ring-labels="right"] {
    opacity: 1;
    transform: scale(var(--zoom-scale)) translate(-25%, -205px);
  }
</style>

<script>
  import { initializeOnReady, QUADRANTS } from "./radarUtils";

  // Create reverse mapping: key -> name
  const quadrantNameMap: Record<string, string> = Object.fromEntries(
    Object.entries(QUADRANTS).map(([name, config]) => [config.key, name])
  );

  const initRadarHover = () => {
    const wrapper = document.querySelector(".radar-chart-wrapper");
    if (!wrapper) return;

    const chart = wrapper.querySelector(".radar-chart");
    const quadrants = wrapper.querySelectorAll(".quadrant-wrapper");
    const labels = wrapper.querySelectorAll(".quadrant-label");
    const tiles = wrapper.querySelectorAll(".quadrant-tile");
    const tilesContainer = wrapper.querySelector(".quadrant-tiles");

    // Set up hover for radar quadrants
    quadrants.forEach((quadrant) => {
      const quadrantKey = quadrant.getAttribute("data-quadrant");
      const correspondingLabel = Array.from(labels).find(
        (label) => label.getAttribute("data-label-quadrant") === quadrantKey
      );

      const handleMouseEnter = () => {
        // Only show hover effect if not zoomed
        if (!chart?.classList.contains("zoomed")) {
          chart?.classList.add("hovering");
          quadrant.classList.add("active");
          if (correspondingLabel) {
            correspondingLabel.classList.add("active");
          }
        }
      };

      const handleMouseLeave = () => {
        chart?.classList.remove("hovering");
        quadrant.classList.remove("active");
        if (correspondingLabel) {
          correspondingLabel.classList.remove("active");
        }
      };

      quadrant.addEventListener("mouseenter", handleMouseEnter);
      quadrant.addEventListener("mouseleave", handleMouseLeave);
    });

    // Set up hover for tiles (mobile view)
    tiles.forEach((tile) => {
      const handleMouseEnter = () => {
        // Only show hover effect if not zoomed
        if (!tilesContainer?.classList.contains("zoomed")) {
          tilesContainer?.classList.add("hovering");
          tile.classList.add("active");
        }
      };

      const handleMouseLeave = () => {
        tilesContainer?.classList.remove("hovering");
        tile.classList.remove("active");
      };

      tile.addEventListener("mouseenter", handleMouseEnter);
      tile.addEventListener("mouseleave", handleMouseLeave);
    });
  };

  const initRadarZoom = () => {
    const wrapper = document.querySelector(".radar-chart-wrapper");
    if (!wrapper) return;

    // Get animation durations from CSS variables
    const computedStyle = getComputedStyle(wrapper);

    // Helper to safely parse CSS variable durations
    const parseDuration = (value: string, fallback: number): number => {
      const parsed = parseInt(value.replace("ms", "").trim());
      return isNaN(parsed) ? fallback : parsed;
    };

    const fadeOutDuration = parseDuration(
      computedStyle.getPropertyValue("--fade-out-duration"),
      300
    );
    const zoomDuration = parseDuration(
      computedStyle.getPropertyValue("--zoom-duration"),
      500
    );
    const slideDuration = parseDuration(
      computedStyle.getPropertyValue("--slide-duration"),
      400
    );

    // Get all elements once
    const chart = wrapper.querySelector(".radar-chart");
    const quadrants = wrapper.querySelectorAll(".quadrant-wrapper");
    const labels = wrapper.querySelectorAll(".quadrant-label");
    const tiles = wrapper.querySelectorAll(".quadrant-tile");
    const tilesContainer = wrapper.querySelector(".quadrant-tiles");
    const itemLists = wrapper.querySelectorAll(".quadrant-item-list");

    // Set up zoom for radar quadrants
    quadrants.forEach((quadrant) => {
      const quadrantKey = quadrant.getAttribute("data-quadrant");
      const correspondingLabel = Array.from(labels).find(
        (label) => label.getAttribute("data-label-quadrant") === quadrantKey
      );

      quadrant.addEventListener("click", (e) => {
        // Check if the click is on a radar item (link)
        const target = e.target as HTMLElement;
        if (target.closest("a")) {
          // Let the link handle the click
          return;
        }

        // Prevent the click from bubbling
        e.stopPropagation();

        // Toggle zoom state
        const isCurrentlyZoomed = quadrant.classList.contains("zoomed-in");

        if (isCurrentlyZoomed) {
          // Zoom out - hide list and slide wrapper back, then zoom out
          itemLists.forEach((list) => {
            list.classList.remove("visible");
            list.classList.add("sliding-out");
          });
          wrapper.classList.remove("list-visible");
          wrapper.classList.remove("list-animation-complete");

          // Wait for list animation to complete before zooming out
          setTimeout(() => {
            chart?.classList.remove("zoomed");
            chart?.classList.remove(
              "zoom-tools",
              "zoom-techniques",
              "zoom-platforms",
              "zoom-frameworks"
            );
            quadrants.forEach((q) => q.classList.remove("zoomed-in"));
            labels.forEach((l) => l.classList.remove("zoomed-in"));
            itemLists.forEach((list) => {
              list.classList.add("hidden");
              list.classList.remove("sliding-out");
            });
          }, slideDuration);
        } else {
          // Zoom in - add zoom class to chart and this quadrant
          chart?.classList.add("zoomed");
          chart?.classList.remove(
            "zoom-tools",
            "zoom-techniques",
            "zoom-platforms",
            "zoom-frameworks"
          );
          chart?.classList.add(`zoom-${quadrantKey}`);
          quadrants.forEach((q) => q.classList.remove("zoomed-in"));
          labels.forEach((l) => l.classList.remove("zoomed-in"));
          quadrant.classList.add("zoomed-in");
          if (correspondingLabel) {
            correspondingLabel.classList.add("zoomed-in");
          }

          // Show the corresponding item list after zoom animation completes
          setTimeout(() => {
            // Slide wrapper and show list simultaneously
            wrapper.classList.add("list-visible");

            // Add list-animation-complete after fade-out completes
            setTimeout(() => {
              wrapper.classList.add("list-animation-complete");
            }, fadeOutDuration);

            itemLists.forEach((list) => {
              const listQuadrant = list
                .querySelector("h3")
                ?.textContent?.trim();
              const quadrantName = quadrantNameMap[quadrantKey || ""] || "";
              if (listQuadrant === quadrantName) {
                list.classList.remove("hidden");
                // Use requestAnimationFrame to ensure display:block is applied before animation
                requestAnimationFrame(() => {
                  list.classList.add("visible");
                });
              } else {
                list.classList.add("hidden");
                list.classList.remove("visible");
              }
            });
          }, zoomDuration);
        }
      });
    });

    // Set up zoom for tiles (mobile view)
    tiles.forEach((tile) => {
      const quadrantKey = tile.getAttribute("data-quadrant-tile");

      tile.addEventListener("click", () => {
        // Check if currently zoomed
        const isCurrentlyZoomed = tile.classList.contains("zoomed-in");

        if (isCurrentlyZoomed) {
          // Zoom out - slide list out right and tiles in from left simultaneously
          wrapper.classList.remove("list-animation-complete");

          // Show tiles positioned off-screen left and start sliding in
          tilesContainer?.classList.remove("sliding-out");
          tilesContainer?.classList.add("sliding-in");

          // Slide list out to right
          itemLists.forEach((list) => {
            list.classList.remove("visible");
            list.classList.add("sliding-out");
          });
          wrapper.classList.remove("list-visible");

          // Use requestAnimationFrame to ensure sliding-in class is applied before removing it
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              tilesContainer?.classList.remove("sliding-in");
            });
          });

          // After slide animation completes, zoom out the tile
          setTimeout(() => {
            // Remove .zoomed to show all tiles, then start zoom-out animation
            tilesContainer?.classList.remove("zoomed");

            // Start zoom out animation
            tile.classList.remove("zooming-in");
            tile.classList.add("zooming-out");

            // Also clear radar chart zoom state
            chart?.classList.remove("zoomed");
            chart?.classList.remove(
              "zoom-tools",
              "zoom-techniques",
              "zoom-platforms",
              "zoom-frameworks"
            );
            quadrants.forEach((q) => q.classList.remove("zoomed-in"));
            labels.forEach((l) => l.classList.remove("zoomed-in"));
            itemLists.forEach((list) => {
              list.classList.add("hidden");
              list.classList.remove("sliding-out");
            });

            // Wait for zoom-out animation to complete before removing classes
            setTimeout(() => {
              tiles.forEach((t) => {
                t.classList.remove("zoomed-in");
                t.classList.remove("zooming-out");
              });
            }, zoomDuration);
          }, slideDuration);
        } else {
          // Zoom in - start animation first, add .zoomed after animation completes
          tiles.forEach((t) => {
            t.classList.remove("zoomed-in");
            t.classList.remove("zooming-in");
            t.classList.remove("zooming-out");
          });
          tile.classList.add("zoomed-in");
          tile.classList.add("zooming-in");

          // Set up zoom state for the radar chart (for when screen size increases)
          chart?.classList.add("zoomed");
          chart?.classList.remove(
            "zoom-tools",
            "zoom-techniques",
            "zoom-platforms",
            "zoom-frameworks"
          );
          chart?.classList.add(`zoom-${quadrantKey}`);

          // Find and zoom the corresponding quadrant
          quadrants.forEach((q) => {
            const qKey = q.getAttribute("data-quadrant");
            if (qKey === quadrantKey) {
              q.classList.add("zoomed-in");
            } else {
              q.classList.remove("zoomed-in");
            }
          });

          // Update labels
          labels.forEach((l) => {
            const lKey = l.getAttribute("data-label-quadrant");
            if (lKey === quadrantKey) {
              l.classList.add("zoomed-in");
            } else {
              l.classList.remove("zoomed-in");
            }
          });

          // After zoom completes, slide tiles out left and list in from right simultaneously
          setTimeout(() => {
            // Remove zooming-in class and add .zoomed to hide other tiles
            tile.classList.remove("zooming-in");
            tilesContainer?.classList.add("zoomed");

            // Start sliding tiles out to the left
            tilesContainer?.classList.add("sliding-out");

            // Prepare and slide list in from right
            wrapper.classList.add("list-visible");

            itemLists.forEach((list) => {
              const listQuadrant = list
                .querySelector("h3")
                ?.textContent?.trim();
              const quadrantName = quadrantNameMap[quadrantKey || ""] || "";
              if (listQuadrant === quadrantName) {
                list.classList.remove("hidden");
                requestAnimationFrame(() => {
                  list.classList.add("visible");
                });
              } else {
                list.classList.add("hidden");
                list.classList.remove("visible");
              }
            });

            // After slide completes, hide tiles completely
            setTimeout(() => {
              wrapper.classList.add("list-animation-complete");
            }, slideDuration);
          }, zoomDuration);
        }
      });
    });

    // Handle back to radar button clicks (once for all back buttons)
    const backButtons = wrapper.querySelectorAll(".back-to-radar");
    backButtons.forEach((button) => {
      button.addEventListener("click", () => {
        // Slide list out right and tiles in from left simultaneously
        wrapper.classList.remove("list-animation-complete");

        // Show tiles positioned off-screen left and start sliding in
        tilesContainer?.classList.remove("sliding-out");
        tilesContainer?.classList.add("sliding-in");

        // Slide list out to right
        itemLists.forEach((list) => {
          list.classList.remove("visible");
          list.classList.add("sliding-out");
        });
        wrapper.classList.remove("list-visible");

        // Use requestAnimationFrame to ensure sliding-in class is applied before removing it
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            tilesContainer?.classList.remove("sliding-in");
          });
        });

        // After slide animation completes, zoom out
        setTimeout(() => {
          // Remove .zoomed to show all tiles, then start zoom-out animation
          tilesContainer?.classList.remove("zoomed");

          // Clear radar chart zoom state
          chart?.classList.remove("zoomed");
          chart?.classList.remove(
            "zoom-tools",
            "zoom-techniques",
            "zoom-platforms",
            "zoom-frameworks"
          );
          quadrants.forEach((q) => q.classList.remove("zoomed-in"));
          labels.forEach((l) => l.classList.remove("zoomed-in"));
          itemLists.forEach((list) => {
            list.classList.add("hidden");
            list.classList.remove("sliding-out");
          });

          // Start zoom out animation on the currently zoomed tile
          tiles.forEach((t) => {
            if (t.classList.contains("zoomed-in")) {
              t.classList.remove("zooming-in");
              t.classList.add("zooming-out");
            }
          });

          // Wait for zoom-out animation to complete before removing classes
          setTimeout(() => {
            tiles.forEach((t) => {
              t.classList.remove("zoomed-in");
              t.classList.remove("zooming-out");
            });
          }, zoomDuration);
        }, slideDuration);
      });
    });
  };

  const initItemListHover = () => {
    const wrapper = document.querySelector(".radar-chart-wrapper");
    if (!wrapper) return;

    const radarItems = wrapper.querySelectorAll(".radar-item");
    const listItems = wrapper.querySelectorAll(".quadrant-item-list li a");

    listItems.forEach((link) => {
      const href = link.getAttribute("href");
      if (!href) return;

      // Extract slug from the link (handle both with and without query params)
      const slug = href.split("?")[0].replace("/radar-items/", "");

      // Find corresponding radar item by slug
      const matchingRadarItem = Array.from(radarItems).find((item) => {
        const itemLink = item.querySelector("a");
        const itemHref = itemLink?.getAttribute("href");
        const itemSlug = itemHref?.split("?")[0].replace("/radar-items/", "");
        return itemSlug === slug;
      });

      if (matchingRadarItem) {
        link.addEventListener("mouseenter", () => {
          matchingRadarItem.classList.add("highlighted");
        });

        link.addEventListener("mouseleave", () => {
          matchingRadarItem.classList.remove("highlighted");
        });
      }
    });
  };

  const initRadar = () => {
    initRadarHover();
    initRadarZoom();
    initItemListHover();
  };

  // Initialize on page load
  initializeOnReady(initRadar);
</script>
